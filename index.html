<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Dogfight Destruction v1.0</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0;}
  html,body{width:100%;height:100%;overflow:hidden;font-family:'Inter',sans-serif;background:#60A5FA;color:#0b2447;}
  #gameCanvas{display:block;background:#bfdbfe;position:absolute;top:0;left:0;z-index:1;}
  .ui-container{position:absolute;top:0;left:0;width:100%;height:100%;z-index:4;pointer-events:none;display:flex;flex-direction:column;justify-content:space-between;align-items:center;}
  #scoreDisplay{font-size:2.4rem;font-weight:900;margin-top:1.5rem;text-shadow:0 0 8px rgba(255,255,255,0.3);pointer-events:auto;color:#0b2447;}
  #messageOverlay{font-size:1.1rem;font-weight:700;text-align:center;animation:pulse 2s infinite;pointer-events:auto;color:#07203b;}
  @keyframes pulse{0%{opacity:1;transform:scale(1);}50%{opacity:0.8;transform:scale(1.02);}100%{opacity:1;transform:scale(1);}}
  #gameOverModal{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:6;background-color:#111827;padding:2rem;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.45);text-align:center;display:none;pointer-events:auto;color:#e6eef9;}
  #gameOverModal h1{font-size:2rem;margin-bottom:0.5rem;}
  #gameOverModal p{font-size:1rem;margin-bottom:1rem;color:#cbd5e1;}
  #restartButton{font-family:'Inter',sans-serif;background:#3B82F6;color:white;border:none;padding:0.8rem 1.4rem;border-radius:8px;font-size:1rem;font-weight:800;cursor:pointer;transition:all 0.18s ease;box-shadow:0 6px 18px rgba(59,130,246,0.25);}
  #restartButton:hover{transform:translateY(-3px); background:#2563EB;}
  .touch-zone{position:absolute;top:0;width:50%;height:100%;z-index:3;pointer-events:auto;}
  #touchLeft{left:0;}
  #touchRight{right:0;}
  .hint { position:absolute; bottom:18px; left:50%; transform:translateX(-50%); font-weight:700; pointer-events:none; color:rgba(3,37,65,0.9);}
  #achievementContainer{position:absolute;top:80px;left:50%;transform:translateX(-50%);pointer-events:none;z-index:5;}
  #marathonBarContainer{position:relative;width:320px;height:16px;background:rgba(0,0,0,0.2);border-radius:8px;margin-top:0.5rem;overflow:hidden;pointer-events:none;}
  #marathonBar{width:0%;height:100%;background:#3B82F6;border-radius:8px;box-shadow:0 0 6px rgba(255,255,255,0.6);transition:width 0.2s ease;}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<!-- Touch zones -->
<div class="touch-zone" id="touchLeft"></div>
<div class="touch-zone" id="touchRight"></div>

<div class="ui-container">
  <div id="marathonBarContainer"><div id="marathonBar"></div></div>
  <div id="scoreDisplay">0</div>
  <div id="messageOverlay">Tap/Press Left/Right to Steer ¬∑ Spacebar to Shoot ¬∑ Press any key to Start<br>Press <strong>P</strong> to Pause</div>
</div>

<div id="achievementContainer"></div>

<div id="gameOverModal">
  <h1>Game Over</h1>
  <p>Your final score is: <strong><span id="finalScore">0</span></strong></p>
  <p>High Score: <strong><span id="bestScore">0</span></strong></p>
  <button id="restartButton">Retry</button>
</div>

<script>
/* ============================
   SETUP + CONSTANTS
============================ */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('scoreDisplay');
const messageOverlay = document.getElementById('messageOverlay');
const gameOverModal = document.getElementById('gameOverModal');
const finalScoreDisplay = document.getElementById('finalScore');
const bestScoreDisplay = document.getElementById('bestScore');
const restartButton = document.getElementById('restartButton');
const touchLeft = document.getElementById('touchLeft');
const touchRight = document.getElementById('touchRight');
const marathonBar = document.getElementById('marathonBar');
const achievementContainer = document.getElementById('achievementContainer');

let gameState = 'menu';
let score = 0, lastTime = 0, gameTime = 0;
let antiCheatTimer = 0;
let antiCheatTriggered = false;

const camera = { x:0, y:0 };
const PLAYER_SPEED = 120;
const PLAYER_TURN_SPEED = 3.5;
const JET_WIDTH = 48, JET_HEIGHT = 48, JET_RADIUS = 16;
const ENEMY_SPEED = 120, ENEMY_TURN_SPEED = 2.1;
const MAX_ENEMIES = 5;
let spawnTimer = 0, spawnInterval = 4.5;

const input = { left:false, right:false, fire:false };
let player = null, enemies = [], particles = [], contrails = [], bullets = [];
let lastShotTime = 0, SHOT_COOLDOWN = 5, BULLET_SPEED = 2400, BULLET_RADIUS = 5;
let highScore = Number(localStorage.getItem('jet_dogfight_high') || 0);

const MINIMAP_SCOPE = 4000;
const ENEMY_SPAWN_INVULN = 1.5;
const DEBUG = false;

/* ============================
   SVG IMAGES
============================ */
const svgPlayer = `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><g transform="translate(32,32)"><polygon points="0,-28 8,-8 20,0 8,8 0,28 -8,8 -20,0 -8,-8" fill="#3B82F6" stroke="#1e3a8a" stroke-width="1"/><polygon points="0,-24 5,-8 12,0 5,8 0,24 -5,8 -12,0 -5,-8" fill="#60A5FA"/><ellipse cx="0" cy="-8" rx="4" ry="5" fill="#93C5FD"/><polygon points="-6,12 -10,18 -6,12" fill="#1e3a8a" opacity="0.6"/><polygon points="6,12 10,18 6,12" fill="#1e3a8a" opacity="0.6"/></g></svg>`;
const svgEnemy = `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><g transform="translate(32,32)"><polygon points="0,-28 8,-8 20,0 8,8 0,28 -8,8 -20,0 -8,-8" fill="#EF4444" stroke="#7f1d1d" stroke-width="1"/><polygon points="0,-24 5,-8 12,0 5,8 0,24 -5,8 -12,0 -5,-8" fill="#F87171"/><ellipse cx="0" cy="-8" rx="4" ry="5" fill="#FECACA"/><polygon points="-6,12 -10,18 -6,12" fill="#7f1d1d" opacity="0.6"/><polygon points="6,12 10,18 6,12" fill="#7f1d1d" opacity="0.6"/></g></svg>`;

function svgToImg(svgString,onload){const img=new Image();img.src='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svgString);img.onload=()=>{if(onload)onload(img);};img.onerror=()=>{if(onload)onload(img);};return img;}
const imgPlayerJet=svgToImg(svgPlayer);
const imgEnemyJet=svgToImg(svgEnemy);

/* ============================
   ACHIEVEMENT SYSTEM VARIABLES
============================ */
let distanceTraveled = 0;
let enemiesDestroyedThisMatch = 0;

const achievements = [
  { id:'risingAce', name:'Rising Ace', desc:'Reach a score of 5000', unlocked:false, check:() => score>=5000 },
  { id:'skyDominator', name:'Sky Dominator', desc:'Reach a score of 10000', unlocked:false, check:() => score>=10000 },
  { id:'topGun', name:'Top Gun', desc:'Destroy 50 enemies in one match', unlocked:false, check:() => enemiesDestroyedThisMatch>=50 },
  { id:'marathon', name:'Marathon', desc:'Travel 2600.2 pixels in one match', unlocked:false, check:() => distanceTraveled>=2600.2 },
];

function unlockAchievement(ach){
  if(!ach) return;
  if(ach.unlocked) return;
  ach.unlocked = true;
  const notif = document.createElement('div');
  notif.style.cssText = `
    background: rgba(59,130,246,0.9);
    color: #fff;
    padding: 0.8rem 1.4rem;
    margin-top:0.6rem;
    border-radius:8px;
    font-weight:700;
    box-shadow:0 4px 12px rgba(0,0,0,0.35);
    opacity:0;
    transform:translateY(-20px);
    transition: all 0.5s ease;
    text-align:center;
  `;
  notif.innerHTML = `üèÜ ${ach.name}<br><small style="font-weight:400;">${ach.desc}</small>`;
  achievementContainer.appendChild(notif);
  requestAnimationFrame(()=>{ notif.style.opacity=1; notif.style.transform='translateY(0)'; });
  setTimeout(()=>{
    notif.style.opacity=0;
    notif.style.transform='translateY(-20px)';
    setTimeout(()=>achievementContainer.removeChild(notif),500);
  },3000);
}

function checkAchievements(){
  achievements.forEach(a=>unlockAchievement(a.check()?a:null));
  marathonBar.style.width=Math.min(distanceTraveled/2600.2,1)*100+'%';
}

/* ============================
   FULL ORIGINAL GAME CODE INTEGRATED
============================ */
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
function rand(min,max){ return Math.random()*(max-min)+min; }
function getDistance(x1,y1,x2,y2){ return Math.hypot(x2 - x1, y2 - y1); }
function wrapAngle(a){ return (a + Math.PI) % (Math.PI*2) - Math.PI; }
function createJet(x,y,angle,speed,turnSpeed,color,type){
  return { x,y,angle,speed,turnSpeed,color,type,width:JET_WIDTH,height:JET_HEIGHT,radius:JET_RADIUS,velX:0,velY:0,spawnTime:gameTime };
}

function resetGame(){
  player = createJet(0,0,-Math.PI/2,PLAYER_SPEED,PLAYER_TURN_SPEED,'#3B82F6','player');
  enemies = []; particles = []; contrails = []; bullets = [];
  score = 0; gameTime = 0; spawnTimer = 1.8; spawnInterval = 4.5;
  gameState = 'playing';
  gameOverModal.style.display = 'none';
  messageOverlay.style.display = 'none';
  scoreDisplay.style.display = 'block';
  antiCheatTimer = 0;
  antiCheatTriggered = false;
  distanceTraveled = 0;
  enemiesDestroyedThisMatch = 0;
  achievements.forEach(a=>a.unlocked=false);
  marathonBar.style.width = '0%';
}

function spawnEnemy(){
  if (enemies.length >= MAX_ENEMIES) return;
  const spawnAngle = Math.random()*Math.PI*2;
  const spawnDist = Math.max(canvas.width, canvas.height)*0.8;
  const x = player.x + Math.cos(spawnAngle)*spawnDist;
  const y = player.y + Math.sin(spawnAngle)*spawnDist;
  const angle = Math.atan2(player.y - y, player.x - x);
  enemies.push(createJet(x,y,angle,ENEMY_SPEED,ENEMY_TURN_SPEED,'#EF4444','enemy'));
}

function createExplosion(x,y,count){
  for(let i=0;i<count;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = rand(40,220);
    const life = rand(0.6,1.6);
    particles.push({ x,y,dx:Math.cos(angle)*speed,dy:Math.sin(angle)*speed,life,maxLife:life,size:rand(2,5) });
  }
}

function showGameOver(){
  gameState = 'gameOver';
  scoreDisplay.style.display = 'none';
  messageOverlay.style.display = 'none';
  finalScoreDisplay.textContent = score;
  if (score > highScore){ highScore = score; localStorage.setItem('jet_dogfight_high', highScore); }
  bestScoreDisplay.textContent = highScore;
  gameOverModal.style.display = 'block';
}

function showAntiCheat(){
  gameState = 'gameOver';
  scoreDisplay.style.display = 'none';
  messageOverlay.style.display = 'none';
  finalScoreDisplay.textContent = score;
  if (score > highScore){ highScore = score; localStorage.setItem('jet_dogfight_high', highScore); }
  bestScoreDisplay.textContent = highScore;
  gameOverModal.style.display = 'block';
  gameOverModal.querySelector('h1').textContent = 'Anti Cheat Is: Active';
  restartButton.textContent = 'Restart Game';
}

function drawJet(ctx, ent){
  ctx.save();
  ctx.translate(ent.x, ent.y);
  ctx.rotate(ent.angle);
  const img = ent.type === 'player' ? imgPlayerJet : imgEnemyJet;
  const w = ent.width;
  const h = ent.height;
  if (img && img.complete && img.width){
    ctx.drawImage(img, -w/2, -h/2, w, h);
  } else {
    ctx.fillStyle = ent.color;
    ctx.beginPath();
    ctx.moveTo(h/2,0);
    ctx.lineTo(-h/2, w/2);
    ctx.lineTo(-h/3,0);
    ctx.lineTo(-h/2, -w/2);
    ctx.closePath();
    ctx.fill();
  }
  if (ent.type === 'enemy' && gameTime - ent.spawnTime < ENEMY_SPAWN_INVULN) {
    ctx.globalAlpha = 0.6;
  }
  if (DEBUG){
    ctx.strokeStyle = '#00ff00';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.arc(0,0,ent.radius,0,Math.PI*2);
    ctx.stroke();
  }
  ctx.restore();
}

function spawnBulletFromJet(jet){
  const nose = (jet.height/2) + 6;
  const bx = jet.x + Math.cos(jet.angle) * nose;
  const by = jet.y + Math.sin(jet.angle) * nose;
  bullets.push({ x:bx, y:by, vx:Math.cos(jet.angle)*BULLET_SPEED, vy:Math.sin(jet.angle)*BULLET_SPEED, life:2.2 });
}

/* ============================
   UPDATE LOOP
============================ */
function update(dt){
  if (!dt || isNaN(dt)) return;
  if (gameState !== 'playing') return;
  gameTime += dt;

  // Anti-cheat
  if (input.fire && (input.left || input.right)) {
    antiCheatTimer += dt;
    if (antiCheatTimer >= 5 && !antiCheatTriggered) {
      antiCheatTriggered = true;
      createExplosion(player.x, player.y, 30);
      showAntiCheat();
      return;
    }
  } else {
    antiCheatTimer = 0;
  }

  // Player
  if (input.left) player.angle -= player.turnSpeed * dt;
  if (input.right) player.angle += player.turnSpeed * dt;
  player.velX += Math.cos(player.angle) * player.speed * dt * 0.55;
  player.velY += Math.sin(player.angle) * player.speed * dt * 0.55;
  player.velX *= 0.92;
  player.velY *= 0.92;
  player.x += player.velX;
  player.y += player.velY;

  distanceTraveled += Math.hypot(player.velX,player.velY);

  contrails.push({ x:player.x, y:player.y, angle:player.angle, life:1 });
  if (input.fire && gameTime - lastShotTime >= SHOT_COOLDOWN){
    spawnBulletFromJet(player);
    lastShotTime = gameTime;
  }

  // Enemies
  spawnTimer -= dt;
  if (spawnTimer <= 0){ spawnEnemy(); spawnTimer = spawnInterval; }
  enemies.forEach((e,i)=>{
    const targetAngle = Math.atan2(player.y-e.y,player.x-e.x);
    const delta = wrapAngle(targetAngle - e.angle);
    e.angle += Math.sign(delta) * e.turnSpeed * dt;
    e.velX += Math.cos(e.angle)*e.speed*dt*0.55;
    e.velY += Math.sin(e.angle)*e.speed*dt*0.55;
    e.velX *= 0.92; e.velY *= 0.92;
    e.x += e.velX; e.y += e.velY;

    bullets.forEach((b,bi)=>{
      if (getDistance(b.x,b.y,e.x,e.y) < e.radius + BULLET_RADIUS){
        bullets.splice(bi,1);
        enemies.splice(i,1);
        createExplosion(e.x,e.y,16);
        score += 100;
        enemiesDestroyedThisMatch++;
      }
    });
  });

  bullets.forEach((b,i)=>{
    b.x += b.vx*dt; b.y += b.vy*dt;
    b.life -= dt;
    if (b.life<=0) bullets.splice(i,1);
  });

  // Contrails
  contrails.forEach((c,i)=>{ c.life-=dt; if(c.life<=0) contrails.splice(i,1); });

  // Update score display
  scoreDisplay.textContent = Math.floor(score);

  // Check achievements
  checkAchievements();
}

/* ============================
   RENDER LOOP
============================ */
function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  contrails.forEach(c=>{
    ctx.save(); ctx.translate(c.x,c.y); ctx.rotate(c.angle);
    ctx.fillStyle = 'rgba(255,255,255,'+c.life/1+')';
    ctx.fillRect(-2,-2,4,4); ctx.restore();
  });
  player && drawJet(ctx,player);
  enemies.forEach(e=>drawJet(ctx,e));
  bullets.forEach(b=>{
    ctx.beginPath(); ctx.arc(b.x,b.y,BULLET_RADIUS,0,Math.PI*2); ctx.fillStyle='#FCD34D'; ctx.fill();
  });
}

/* ============================
   MAIN LOOP
============================ */
let lastFrame = performance.now();
function loop(ts){
  const dt = (ts - lastFrame)/1000;
  lastFrame = ts;
  update(dt);
  render();
  requestAnimationFrame(loop);
}
resizeCanvas();
window.addEventListener('resize',resizeCanvas);
loop(performance.now());

/* ============================
   INPUT HANDLERS
============================ */
window.addEventListener('keydown',e=>{
  if (gameState === 'menu' || gameState==='gameOver'){ resetGame(); return; }
  if (e.code==='ArrowLeft') input.left=true;
  if (e.code==='ArrowRight') input.right=true;
  if (e.code==='Space') input.fire=true;
  if (e.code==='KeyP') gameState = gameState==='playing'?'paused':'playing';
});
window.addEventListener('keyup',e=>{
  if (e.code==='ArrowLeft') input.left=false;
  if (e.code==='ArrowRight') input.right=false;
  if (e.code==='Space') input.fire=false;
});
touchLeft.addEventListener('touchstart',()=>input.left=true);
touchLeft.addEventListener('touchend',()=>input.left=false);
touchRight.addEventListener('touchstart',()=>input.right=true);
touchRight.addEventListener('touchend',()=>input.right=false);

restartButton.addEventListener('click',()=>{ resetGame(); });

</script>
</body>
</html>
