<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Police Pursuit</title>
<style>
html,body {margin:0; padding:0; overflow:hidden; background:#1a1a1a; touch-action:none;}
canvas {display:block; background:#333;}
#ui {position:absolute; top:0; left:0; width:100%; color:white; font-family:sans-serif; text-align:center;}
#score {font-size:2em; margin-top:10px;}
#highScore {font-size:1em; color:#aaa;}
#message {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:1.5em; text-align:center;}
#gameOver {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#222; padding:20px; border-radius:10px; display:none;}
button {padding:10px 20px; font-size:1em; margin-top:10px;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">
  <div id="score">Score: 0</div>
  <div id="highScore">High Score: 0</div>
</div>
<div id="message">Tap or Press Any Key to Start</div>
<div id="gameOver">
  <div id="finalScore"></div>
  <div id="bestScore"></div>
  <button onclick="resetGame()">Retry</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
window.addEventListener("resize",resize);resize();

let keys = {left:false, right:false};
let score = 0, highScore = Number(localStorage.getItem("pp_highscore")||0);
let playing = false, gameOver = false;

const player = {x:0,y:0,angle:0,speed:3,velX:0,velY:-3,width:20,height:40,drift:0};
let police = [];
let skidMarks = [];
let scenery = [];

function startGame(){
  playing = true; gameOver = false; score = 0;
  player.x=0;player.y=0;player.angle=-Math.PI/2;player.velX=0;player.velY=-3;player.drift=0;
  police=[];skidMarks=[];scenery=[];
  for(let i=0;i<200;i++){scenery.push({x:(Math.random()-0.5)*2000,y:(Math.random()-0.5)*2000,size:Math.random()*30+10})}
  document.getElementById("message").style.display="none";
  document.getElementById("gameOver").style.display="none";
}

function spawnPolice(){
  const angle=Math.random()*Math.PI*2;
  const dist=400;
  police.push({x:player.x+Math.cos(angle)*dist,y:player.y+Math.sin(angle)*dist,angle:angle,speed:2});
}

function update(){
  if(!playing)return;
  score += 0.05;
  document.getElementById("score").textContent = "Score: "+Math.floor(score);
  document.getElementById("highScore").textContent = "High Score: "+Math.floor(highScore);

  // Drift steering
  if(keys.left) player.angle -= 0.04;
  if(keys.right) player.angle += 0.04;

  player.velX += Math.cos(player.angle)*0.1;
  player.velY += Math.sin(player.angle)*0.1;
  player.velX *= 0.98;
  player.velY *= 0.98;

  player.x += player.velX;
  player.y += player.velY;

  // Add skid marks when turning
  if(keys.left||keys.right){
    skidMarks.push({x:player.x,y:player.y,angle:player.angle,life:1});
    if(skidMarks.length>300) skidMarks.shift();
  }

  // Police movement
  for(let p of police){
    const a=Math.atan2(player.y-p.y,player.x-p.x);
    p.x+=Math.cos(a)*p.speed;
    p.y+=Math.sin(a)*p.speed;
    if(Math.hypot(player.x-p.x,player.y-p.y)<25) endGame();
  }

  if(Math.random()<0.02 && police.length<10) spawnPolice();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2-player.x, canvas.height/2-player.y);

  // Draw scenery
  ctx.fillStyle="#2f2";
  for(let s of scenery){ctx.beginPath();ctx.arc(s.x,s.y,s.size,0,Math.PI*2);ctx.fill();}

  // Skid marks
  for(let s of skidMarks){
    s.life -= 0.01;
    ctx.save();
    ctx.translate(s.x,s.y);
    ctx.rotate(s.angle);
    ctx.fillStyle=`rgba(0,0,0,${s.life})`;
    ctx.fillRect(-10,-2,20,4);
    ctx.restore();
  }

  // Player car
  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.rotate(player.angle);
  ctx.fillStyle="#4af";
  ctx.fillRect(-10,-20,20,40);
  ctx.restore();

  // Police cars
  ctx.fillStyle="red";
  for(let p of police){
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.fillRect(-10,-20,20,40);
    ctx.restore();
  }

  ctx.restore();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

function endGame(){
  playing=false;gameOver=true;
  if(score>highScore){highScore=score;localStorage.setItem("pp_highscore",highScore);}
  document.getElementById("finalScore").textContent="Your Score: "+Math.floor(score);
  document.getElementById("bestScore").textContent="Best: "+Math.floor(highScore);
  document.getElementById("gameOver").style.display="block";
}

function resetGame(){startGame();}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft")keys.left=true;
  if(e.key==="ArrowRight")keys.right=true;
  if(!playing && !gameOver)startGame();
});
document.addEventListener("keyup",e=>{
  if(e.key==="ArrowLeft")keys.left=false;
  if(e.key==="ArrowRight")keys.right=false;
});
canvas.addEventListener("touchstart",e=>{
  const x=e.touches[0].clientX;
  if(x<innerWidth/2)keys.left=true; else keys.right=true;
  if(!playing && !gameOver)startGame();
});
canvas.addEventListener("touchend",()=>{keys.left=false;keys.right=false;});

loop();
</script>
</body>
</html>
